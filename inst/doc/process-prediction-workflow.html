<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to processpredictR: workflow</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to processpredictR:
workflow</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(processpredictR)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bupaR)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: package &#39;keras&#39; was built under R version 4.2.2</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The goal of processpredictR is to perform prediction tasks on
processes using event logs and Transformer models. The 5 process
monitoring tasks are defined as follows:</p>
<ul>
<li><em>outcome</em>: predict the case outcome, which can be the last
activity, or a manually defined variable</li>
<li><em>next activity</em>: predict the next activity instance</li>
<li><em>remaining trace</em>: predict the sequence of all next activity
instances</li>
<li><em>next time</em>: predict the start time of the next activity
instance</li>
<li><em>remaining time</em>: predict the remaining time till the end of
the case</li>
</ul>
<p>The overall approach using <code>processpredictR</code> is shown in
the Figure below. <code>prepare_examples()</code> transforms logs into a
dataset that can be used for training and prediction, which is
thereafter split into train and test set. Subsequently a model is made,
compiled and fit. Finally, the model can be used to predict and can be
evaluated</p>
<p><img src="data:image/png;base64,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" width="60%" style="display: block; margin: auto;" /></p>
<p>Different levels of customization are offered. Using
<code>create_model()</code>, a standard off-the-shelf model can be
created for each of the supported tasks, including standard
features.</p>
<p>A first customization is to include additional features, such as case
or event attributes. These can be configured in the
<code>prepare_examples()</code> step, and they will be processed
automatically (normalized for numerical features, or hot-encoded for
categorical features).</p>
<p>A further way to customize your model, is to only generate the input
layer of the model with <code>create_model()</code>, and define the
remainder of the model yourself by adding <code>keras</code> layers
using the provided <code>stack_layers()</code> function.</p>
<p>Going beyond that, you can also create the model entirely yourself
using <code>keras</code>, including the preprocessing of the data.
Auxiliary functions are provided to help you with, e.g., tokenizing
activity sequences.</p>
<p>In the remainder of this tutorial, each of the steps and possible
avenues for customization will be described in more detail.</p>
</div>
<div id="preprocessing" class="section level1">
<h1>Preprocessing</h1>
<p>As a first step in the process prediction workflow we use
<code>prepare_examples()</code> to obtain a dataset, where:</p>
<ul>
<li>each row/observation is a unique activity instance id</li>
<li>the prefix(_list) column stores the sequence of activities already
executed in the case</li>
<li>necessary features and target variables are calculated and/or
added</li>
</ul>
<p>The returned object is of class <code>ppred_examples_df</code>, which
inherits from <code>tbl_df</code>.</p>
<p>In this tutorial we will use the <code>traffic_fines</code> event log
from <code>eventdataR</code>. Note that both <code>eventlog</code> and
<code>activitylog</code> objects, as defined by <code>bupaR</code> are
supported.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">prepare_examples</span>(traffic_fines, <span class="at">task =</span> <span class="st">&quot;outcome&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 34,724 × 11</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ith_case case_id prefix                 prefi…¹ outcome     k activ…² resou…³</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                  &lt;list&gt;  &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;fct&gt;  </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1        1 A2127   Create Fine            &lt;chr&gt;   Payment     0 Create… 537    </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2        1 A2127   Create Fine - Payment  &lt;chr&gt;   Payment     1 Payment &lt;NA&gt;   </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3        2 A15     Create Fine            &lt;chr&gt;   Send f…     0 Create… 561    </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4        2 A15     Create Fine - Send Fi… &lt;chr&gt;   Send f…     1 Send F… &lt;NA&gt;   </span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5        2 A15     Create Fine - Send Fi… &lt;chr&gt;   Send f…     2 Insert… &lt;NA&gt;   </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6        2 A15     Create Fine - Send Fi… &lt;chr&gt;   Send f…     3 Add pe… &lt;NA&gt;   </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7        2 A15     Create Fine - Send Fi… &lt;chr&gt;   Send f…     4 Send f… &lt;NA&gt;   </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8        3 A1820   Create Fine            &lt;chr&gt;   Payment     0 Create… 563    </span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9        3 A1820   Create Fine - Payment  &lt;chr&gt;   Payment     1 Payment &lt;NA&gt;   </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10        4 A22     Create Fine            &lt;chr&gt;   Payment     0 Create… 561    </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 34,714 more rows, 3 more variables: start_time &lt;dttm&gt;,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   end_time &lt;dttm&gt;, remaining_trace_list &lt;list&gt;, and abbreviated variable</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   names ¹​prefix_list, ²​activity, ³​resource</span></span></code></pre></div>
<p>We split the transformed dataset <code>df</code> into train- and test
sets for later use in <code>fit()</code> and <code>predict()</code>,
respectively. The proportion of the train set is configured with the
<code>split</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">split_train_test</span>(<span class="at">split =</span> <span class="fl">0.8</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>split<span class="sc">$</span>train_df <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 11</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ith_case case_id prefix                  prefi…¹ outcome     k activ…² resou…³</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                   &lt;list&gt;  &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;fct&gt;  </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        1 A2127   Create Fine             &lt;chr&gt;   Payment     0 Create… 537    </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2        1 A2127   Create Fine - Payment   &lt;chr&gt;   Payment     1 Payment &lt;NA&gt;   </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3        2 A15     Create Fine             &lt;chr&gt;   Send f…     0 Create… 561    </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4        2 A15     Create Fine - Send Fine &lt;chr&gt;   Send f…     1 Send F… &lt;NA&gt;   </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5        2 A15     Create Fine - Send Fin… &lt;chr&gt;   Send f…     2 Insert… &lt;NA&gt;   </span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 3 more variables: start_time &lt;dttm&gt;, end_time &lt;dttm&gt;,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   remaining_trace_list &lt;list&gt;, and abbreviated variable names ¹​prefix_list,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ²​activity, ³​resource</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>split<span class="sc">$</span>test_df <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 11</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ith_case case_id prefix                prefix_…¹ outcome     k activ…² resou…³</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                 &lt;list&gt;    &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;fct&gt;  </span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     8001 A24869  Create Fine           &lt;chr [1]&gt; Payment     0 Create… 559    </span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     8001 A24869  Create Fine - Payment &lt;chr [2]&gt; Payment     1 Payment &lt;NA&gt;   </span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     8002 A24871  Create Fine           &lt;chr [1]&gt; Payment     0 Create… 559    </span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     8002 A24871  Create Fine - Payment &lt;chr [2]&gt; Payment     1 Payment &lt;NA&gt;   </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     8003 A24872  Create Fine           &lt;chr [1]&gt; Send f…     0 Create… 559    </span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 3 more variables: start_time &lt;dttm&gt;, end_time &lt;dttm&gt;,</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   remaining_trace_list &lt;list&gt;, and abbreviated variable names ¹​prefix_list,</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ²​activity, ³​resource</span></span></code></pre></div>
<p>It’s important to note that the split is done at case level (a case
is fully part of either the train data or either the test data).
Furthermore, the split is done chronologically, meaning that the train
set contains the split% first cases, and the test set contains the
(1-split)% last cases.</p>
<p>Note that because the split is done at case level, the percentage of
all examples in the train set can be slightly different, as cases differ
with respect their length.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(split<span class="sc">$</span>train_df) <span class="sc">/</span> <span class="fu">nrow</span>(df)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.8016934</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(split<span class="sc">$</span>train_df<span class="sc">$</span>case_id) <span class="sc">/</span> <span class="fu">n_distinct</span>(df<span class="sc">$</span>case_id)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.8</span></span></code></pre></div>
</div>
<div id="transformer-model" class="section level1">
<h1>Transformer model</h1>
<p>The next step in the workflow is to build a model.
<code>processpredictR</code> provides a default set of functions that
are wrappers of generics provided by <code>keras</code>. For ease of
use, the preprocessing steps, such as tokenizing of sequences,
normalizing numerical features, etc. happen within the
<code>create_model()</code> function and are abstracted from the
user.</p>
<div id="define-model" class="section level2">
<h2>Define model</h2>
<p>Based on the train set we define the default transformer model, using
<code>create_model()</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> split<span class="sc">$</span>train_df <span class="sc">%&gt;%</span> <span class="fu">create_model</span>(<span class="at">name =</span> <span class="st">&quot;my_model&quot;</span>) </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pass arguments as ... that are applicable to keras::keras_model()</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>model <span class="co"># is a list </span></span></code></pre></div>
<pre><code>#&gt; Model: &quot;my_model&quot;
#&gt; ________________________________________________________________________________
#&gt;  Layer (type)                       Output Shape                    Param #     
#&gt; ================================================================================
#&gt;  input_1 (InputLayer)               [(None, 9)]                     0           
#&gt;  token_and_position_embedding (Toke  (None, 9, 36)                  792         
#&gt;  nAndPositionEmbedding)                                                         
#&gt;  transformer_block (TransformerBloc  (None, 9, 36)                  26056       
#&gt;  k)                                                                             
#&gt;  global_average_pooling1d (GlobalAv  (None, 36)                     0           
#&gt;  eragePooling1D)                                                                
#&gt;  dropout_3 (Dropout)                (None, 36)                      0           
#&gt;  dense_3 (Dense)                    (None, 64)                      2368        
#&gt;  dropout_2 (Dropout)                (None, 64)                      0           
#&gt;  dense_2 (Dense)                    (None, 6)                       390         
#&gt; ================================================================================
#&gt; Total params: 29,606
#&gt; Trainable params: 29,606
#&gt; Non-trainable params: 0
#&gt; ________________________________________________________________________________</code></pre>
<p>Some useful information and metrics are stored for a tracebility and
an easy extraction if needed.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="co"># objects from a returned list</span></span></code></pre></div>
<pre><code>#&gt; $names
#&gt; [1] &quot;model&quot;           &quot;max_case_length&quot; &quot;number_features&quot; &quot;task&quot;           
#&gt; [5] &quot;num_outputs&quot;     &quot;vocabulary&quot;     
</code></pre>
<p>Note that <code>create_model()</code> returns a list, in which the
actual keras model is stored under the element name <code>model</code>.
Thus, we can use functions from the keras-package as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>model<span class="sc">$</span>name <span class="co"># get the name of a model</span></span></code></pre></div>
<pre><code>#&gt; [1] &quot;my_model&quot;
</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>model<span class="sc">$</span>non_trainable_variables <span class="co"># list of non-trainable parameters of a model</span></span></code></pre></div>
<pre><code>#&gt; list()</code></pre>
<p>The result of <code>create_model()</code> is assigned it’s own class
(<code>ppred_model</code>) for which the <code>processpredictR</code>
provides the methods <em>compile()</em>, <em>fit()</em>,
<em>predict()</em> and <em>evaluate()</em>.</p>
</div>
<div id="compilation" class="section level2">
<h2>Compilation</h2>
<p>The following step is to compile the model. By default, the loss
function is the log-cosh or the categorical cross entropy, for
regression tasks (next time and remaining time) and classification
tasks, respectively. It is of course possible to override the
defaults.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">compile</span>() <span class="co"># model compilation</span></span></code></pre></div>
<pre><code>#&gt; Compilation complete!</code></pre>
</div>
<div id="training" class="section level2">
<h2>Training</h2>
<p>Training of the model is done with the <code>fit()</code> function.
During training, a visualization window will open in the Viewer-pane to
show the progress in terms of loss. Optionally, the result of
<code>fit()</code> can be assigned to an object to access the training
metrics specified in <em>compile()</em>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hist <span class="ot">&lt;-</span> <span class="fu">fit</span>(<span class="at">object =</span> model, <span class="at">train_data =</span> split<span class="sc">$</span>train_df, <span class="at">epochs =</span> <span class="dv">5</span>)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>hist<span class="sc">$</span>params</span></code></pre></div>
<pre><code>#&gt; $verbose
#&gt; [1] 1
#&gt; 
#&gt; $epochs
#&gt; [1] 5
#&gt; 
#&gt; $steps
#&gt; [1] 2227</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>hist<span class="sc">$</span>metrics</span></code></pre></div>
<pre><code>#&gt; $loss
#&gt; [1] 0.7875332 0.7410239 0.7388409 0.7385073 0.7363014
#&gt; 
#&gt; $sparse_categorical_accuracy
#&gt; [1] 0.6539739 0.6713067 0.6730579 0.6735967 0.6747193
#&gt; 
#&gt; $val_loss
#&gt; [1] 0.7307042 0.7261314 0.7407018 0.7326428 0.7317348
#&gt; 
#&gt; $val_sparse_categorical_accuracy
#&gt; [1] 0.6725934 0.6727730 0.6725934 0.6725934 0.6722342</code></pre>
</div>
<div id="make-predictions" class="section level2">
<h2>Make predictions</h2>
<p>The method <em>predict()</em> can return 3 types of output, by
setting the argument <code>output</code> to “append”, “y_pred” or
“raw”.</p>
<p>Test dataset with appended predicted values (output = “append”)</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">test_data =</span> split<span class="sc">$</span>test_df, </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">output =</span> <span class="st">&quot;append&quot;</span>) <span class="co"># default</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>predictions <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 5 × 13
#&gt;   ith_case case_id prefix                prefix_…¹ outcome     k activ…² resou…³
#&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                 &lt;list&gt;    &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;fct&gt;  
#&gt; 1     8001 A24869  Create Fine           &lt;chr [1]&gt; Payment     0 Create… 559    
#&gt; 2     8001 A24869  Create Fine - Payment &lt;chr [2]&gt; Payment     1 Payment &lt;NA&gt;   
#&gt; 3     8002 A24871  Create Fine           &lt;chr [1]&gt; Payment     0 Create… 559    
#&gt; 4     8002 A24871  Create Fine - Payment &lt;chr [2]&gt; Payment     1 Payment &lt;NA&gt;   
#&gt; 5     8003 A24872  Create Fine           &lt;chr [1]&gt; Send f…     0 Create… 559    
#&gt; # … with 5 more variables: start_time &lt;dttm&gt;, end_time &lt;dttm&gt;,
#&gt; #   remaining_trace_list &lt;list&gt;, y_pred &lt;dbl&gt;, pred_outcome &lt;chr&gt;, and
#&gt; #   abbreviated variable names ¹​prefix_list, ²​activity, ³​resource</code></pre>
<details>
<summary>
raw predicted values (output = “raw”)
</summary>
<p>
<pre><code>#&gt;              Payment Send for Credit Collection    Send Fine
#&gt;    [1,] 4.966056e-01                0.344094276 1.423686e-01
#&gt;    [2,] 9.984029e-01                0.001501600 8.890528e-05
#&gt;    [3,] 4.966056e-01                0.344094276 1.423686e-01
#&gt;    [4,] 9.984029e-01                0.001501600 8.890528e-05
#&gt;    [5,] 4.966056e-01                0.344094276 1.423686e-01
#&gt;    [6,] 1.556145e-01                0.518976271 2.884890e-01
#&gt;    [7,] 2.345311e-01                0.715000629 5.147375e-06
#&gt;    [8,] 2.627363e-01                0.726804197 5.480492e-06
#&gt;    [9,] 3.347774e-05                0.999961376 2.501280e-08
#&gt;   [10,] 4.966056e-01                0.344094276 1.423686e-01</code></pre>
</details>
</p>
<details>
<summary>
predicted values with postprocessing (output = “y_pred”)
</summary>
<pre><code>#&gt;    [1] &quot;Payment&quot;                    &quot;Payment&quot;                   
#&gt;    [3] &quot;Payment&quot;                    &quot;Payment&quot;                   
#&gt;    [5] &quot;Payment&quot;                    &quot;Send for Credit Collection&quot;
#&gt;    [7] &quot;Send for Credit Collection&quot; &quot;Send for Credit Collection&quot;
#&gt;    [9] &quot;Send for Credit Collection&quot; &quot;Payment&quot;                   
#&gt;   [11] &quot;Send for Credit Collection&quot; &quot;Payment&quot;                   
#&gt;   [13] &quot;Send for Credit Collection&quot; &quot;Payment&quot;                   
#&gt;   [15] &quot;Send for Credit Collection&quot; &quot;Send for Credit Collection&quot;
#&gt;   [17] &quot;Send for Credit Collection&quot; &quot;Send for Credit Collection&quot;
#&gt;   [19] &quot;Payment&quot;                    &quot;Send for Credit Collection&quot;</code></pre>
</details>
</p>
<div id="visualize-predictions" class="section level3">
<h3>Visualize predictions</h3>
<p>For the classification tasks outcome and next activity a
<code>confusion_matrix()</code> function is provided.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="sc">%&gt;%</span> class</span></code></pre></div>
<pre><code>#&gt; [1] &quot;ppred_predictions&quot; &quot;ppred_examples_df&quot; &quot;ppred_examples_df&quot;
#&gt; [4] &quot;ppred_examples_df&quot; &quot;tbl_df&quot;            &quot;tbl&quot;              
#&gt; [7] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusion_matrix</span>(predictions)</span></code></pre></div>
<pre><code>#&gt;                                   
#&gt;                                    Payment Send Appeal to Prefecture
#&gt;   Appeal to Judge                        2                         6
#&gt;   Notify Result Appeal to Offender       0                         0
#&gt;   Payment                             1903                         7
#&gt;   Send Appeal to Prefecture             34                        90
#&gt;   Send Fine                            387                         0
#&gt;   Send for Credit Collection           688                        22
#&gt;                                   
#&gt;                                    Send for Credit Collection
#&gt;   Appeal to Judge                                          10
#&gt;   Notify Result Appeal to Offender                          0
#&gt;   Payment                                                 617
#&gt;   Send Appeal to Prefecture                                89
#&gt;   Send Fine                                               387
#&gt;   Send for Credit Collection                             2644</code></pre>
<p>Plot method for the confusion matrix (classification) or a scatter
plot (regression).</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(predictions) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;confusion_matrix.PNG&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="evaluate-model" class="section level2">
<h2>Evaluate model</h2>
<p>Returns loss and metrics specified in <em>compile()</em>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(split<span class="sc">$</span>test_df)</span></code></pre></div>
<pre><code>#&gt;                        loss sparse_categorical_accuracy 
#&gt;                   0.7779053                   0.6716526</code></pre>
</div>
</div>
<div id="add-extra-features" class="section level1">
<h1>Add extra features</h1>
<p>Next to the activity prefixes in the data, and standard features
defined for each task, additional features can be defined when using
<code>prepare_examples()</code>. The example below shows how the month
in which a case is started can be added as a feature.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># preprocessed dataset with categorical hot encoded features</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_next_time <span class="ot">&lt;-</span> traffic_fines <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_case</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> lubridate<span class="sc">::</span><span class="fu">month</span>(<span class="fu">min</span>(timestamp), <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup_eventlog</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prepare_examples</span>(<span class="at">task =</span> <span class="st">&quot;next_time&quot;</span>, <span class="at">features =</span> <span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">split_train_test</span>()</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the attributes of df are added or changed accordingly</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df_next_time<span class="sc">$</span>train_df <span class="sc">%&gt;%</span> <span class="fu">attr</span>(<span class="st">&quot;features&quot;</span>)</span></code></pre></div>
<pre><code>#&gt;  [1] &quot;latest_duration&quot;      &quot;throughput_time&quot;      &quot;processing_time&quot;     
#&gt;  [4] &quot;time_before_activity&quot; &quot;month_jan&quot;            &quot;month_feb&quot;           
#&gt;  [7] &quot;month_mrt&quot;            &quot;month_apr&quot;            &quot;month_mei&quot;           
#&gt; [10] &quot;month_jun&quot;            &quot;month_jul&quot;            &quot;month_aug&quot;           
#&gt; [13] &quot;month_sep&quot;            &quot;month_okt&quot;            &quot;month_nov&quot;           
#&gt; [16] &quot;month_dec&quot;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_next_time<span class="sc">$</span>train_df <span class="sc">%&gt;%</span> <span class="fu">attr</span>(<span class="st">&quot;hot_encoded_categorical_features&quot;</span>)</span></code></pre></div>
<pre><code>#&gt;  [1] &quot;month_jan&quot; &quot;month_feb&quot; &quot;month_mrt&quot; &quot;month_apr&quot; &quot;month_mei&quot; &quot;month_jun&quot;
#&gt;  [7] &quot;month_jul&quot; &quot;month_aug&quot; &quot;month_sep&quot; &quot;month_okt&quot; &quot;month_nov&quot; &quot;month_dec&quot;</code></pre>
<p>Additional features can be either numerical variables, or factors.
Numerical variables will be automatically normalized. Factors will
automatically be converted to hot-encoded variables. A few important
notes:</p>
<ul>
<li>Character values are not accepted, and should be transformed to
factors.</li>
<li>We assume that no features have missing values. If there are any,
these should be imputed or removed before using
<code>prepare_examples()</code>.</li>
<li>Finally, in case the data is an event log, features should have
single values for each activity instance. Start and complete event
should thus have a single unique value of a variable for it to be used
as feature.</li>
</ul>
</div>
<div id="customize-your-transformer-model" class="section level1">
<h1>Customize your transformer model</h1>
<p>Instead of using the standard <code>off the shelf</code> transformer
model that comes with <code>processpredictR</code>, you can customize
the model. One way to do this, is by using the <code>custom</code>
argument of the <code>create_model()</code> function. The resulting
model will then only contain the input layers of the model, as shown
below.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">prepare_examples</span>(traffic_fines, <span class="at">task =</span> <span class="st">&quot;next_activity&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">split_train_test</span>()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>custom_model <span class="ot">&lt;-</span> df<span class="sc">$</span>train_df <span class="sc">%&gt;%</span> <span class="fu">create_model</span>(<span class="at">custom =</span> <span class="cn">TRUE</span>, <span class="at">name =</span> <span class="st">&quot;my_custom_model&quot;</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>custom_model</span></code></pre></div>
<pre><code>#&gt; Model: &quot;my_custom_model&quot;
#&gt; ________________________________________________________________________________
#&gt;  Layer (type)                       Output Shape                    Param #     
#&gt; ================================================================================
#&gt;  input_2 (InputLayer)               [(None, 9)]                     0           
#&gt;  token_and_position_embedding_1 (To  (None, 9, 36)                  828         
#&gt;  kenAndPositionEmbedding)                                                       
#&gt;  transformer_block_1 (TransformerBl  (None, 9, 36)                  26056       
#&gt;  ock)                                                                           
#&gt;  global_average_pooling1d_1 (Global  (None, 36)                     0           
#&gt;  AveragePooling1D)                                                              
#&gt; ================================================================================
#&gt; Total params: 26,884
#&gt; Trainable params: 26,884
#&gt; Non-trainable params: 0
#&gt; ________________________________________________________________________________</code></pre>
<p>You can than stack layers on top of your custom model as you prefer,
using the <code>stack_layers()</code> function. This function provides
an abstraction from a little bit more code work if <code>keras</code> is
used (see later).</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>custom_model <span class="ot">&lt;-</span> custom_model <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_layers</span>(<span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_layers</span>(<span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">64</span>, <span class="at">activation =</span> <span class="st">&#39;relu&#39;</span>))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>custom_model</span></code></pre></div>
<pre><code>#&gt; Model: &quot;my_custom_model&quot;
#&gt; ________________________________________________________________________________
#&gt;  Layer (type)                       Output Shape                    Param #     
#&gt; ================================================================================
#&gt;  input_2 (InputLayer)               [(None, 9)]                     0           
#&gt;  token_and_position_embedding_1 (To  (None, 9, 36)                  828         
#&gt;  kenAndPositionEmbedding)                                                       
#&gt;  transformer_block_1 (TransformerBl  (None, 9, 36)                  26056       
#&gt;  ock)                                                                           
#&gt;  global_average_pooling1d_1 (Global  (None, 36)                     0           
#&gt;  AveragePooling1D)                                                              
#&gt;  dropout_6 (Dropout)                (None, 36)                      0           
#&gt;  dense_6 (Dense)                    (None, 64)                      2368        
#&gt; ================================================================================
#&gt; Total params: 29,252
#&gt; Trainable params: 29,252
#&gt; Non-trainable params: 0
#&gt; ________________________________________________________________________________
</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this works too</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>custom_model <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_layers</span>(<span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.1</span>), <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">64</span>, <span class="at">activation =</span> <span class="st">&#39;relu&#39;</span>))</span></code></pre></div>
<p>Once you have finalized your model, with an appropriate output-layer
(which should have the correct amount of outputs, as recorded in
<code>customer_model$num_outputs</code> and an appropriate activation
function), you can use the <code>compile()</code>, <code>fit()</code>,
<code>predict()</code> and <code>evaluate()</code> functions as
before.</p>
</div>
<div id="custom-training-and-prediction" class="section level1">
<h1>Custom training and prediction</h1>
<p>We can also opt for setting up and training our model manually,
instead of using the provided methods. Note that after defining a model
with <code>keras::keras_model()</code> the model no longer is of class
<code>ppred_model</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>new_outputs <span class="ot">&lt;-</span> custom_model<span class="sc">$</span>model<span class="sc">$</span>output <span class="sc">%&gt;%</span> <span class="co"># custom_model$model to access a model and $output to access the outputs of that model</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  keras<span class="sc">::</span><span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  keras<span class="sc">::</span><span class="fu">layer_dense</span>(<span class="at">units =</span> custom_model<span class="sc">$</span>num_outputs, <span class="at">activation =</span> <span class="st">&#39;softmax&#39;</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>custom_model <span class="ot">&lt;-</span> keras<span class="sc">::</span><span class="fu">keras_model</span>(<span class="at">inputs =</span> custom_model<span class="sc">$</span>model<span class="sc">$</span>input, <span class="at">outputs =</span> new_outputs, <span class="at">name =</span> <span class="st">&quot;new_custom_model&quot;</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>custom_model</span></code></pre></div>
<pre><code>#&gt; Model: &quot;new_custom_model&quot;
#&gt; ________________________________________________________________________________
#&gt;  Layer (type)                       Output Shape                    Param #     
#&gt; ================================================================================
#&gt;  input_2 (InputLayer)               [(None, 9)]                     0           
#&gt;  token_and_position_embedding_1 (To  (None, 9, 36)                  828         
#&gt;  kenAndPositionEmbedding)                                                       
#&gt;  transformer_block_1 (TransformerBl  (None, 9, 36)                  26056       
#&gt;  ock)                                                                           
#&gt;  global_average_pooling1d_1 (Global  (None, 36)                     0           
#&gt;  AveragePooling1D)                                                              
#&gt;  dropout_6 (Dropout)                (None, 36)                      0           
#&gt;  dense_6 (Dense)                    (None, 64)                      2368        
#&gt;  dropout_8 (Dropout)                (None, 64)                      0           
#&gt;  dense_8 (Dense)                    (None, 11)                      715         
#&gt; ================================================================================
#&gt; Total params: 29,967
#&gt; Trainable params: 29,967
#&gt; Non-trainable params: 0
#&gt; ________________________________________________________________________________</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># class of the model</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>custom_model <span class="sc">%&gt;%</span> class</span></code></pre></div>
<pre><code>#&gt; [1] &quot;keras.engine.functional.Functional&quot;                     
#&gt; [2] &quot;keras.engine.training.Model&quot;                            
#&gt; [3] &quot;keras.engine.base_layer.Layer&quot;                          
#&gt; [4] &quot;tensorflow.python.module.module.Module&quot;                 
#&gt; [5] &quot;tensorflow.python.trackable.autotrackable.AutoTrackable&quot;
#&gt; [6] &quot;tensorflow.python.trackable.base.Trackable&quot;             
#&gt; [7] &quot;keras.utils.version_utils.LayerVersionSelector&quot;         
#&gt; [8] &quot;keras.utils.version_utils.ModelVersionSelector&quot;         
#&gt; [9] &quot;python.builtin.object&quot;</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compile</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compile</span>(<span class="at">object=</span>custom_model, <span class="at">optimizer =</span> <span class="st">&quot;adam&quot;</span>, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">loss =</span> <span class="fu">loss_sparse_categorical_crossentropy</span>(), </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">metrics =</span> <span class="fu">metric_sparse_categorical_crossentropy</span>())</span></code></pre></div>
<p>Before training the model we first must prepare the data, using the
<code>tokenize()</code> function.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the trace of activities must be tokenized</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>tokens_train <span class="ot">&lt;-</span> df<span class="sc">$</span>train_df <span class="sc">%&gt;%</span> <span class="fu">tokenize</span>()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(tokens_train, head) <span class="co"># the output of tokens is a list</span></span></code></pre></div>
<pre><code>#&gt; $token_x
#&gt; $token_x[[1]]
#&gt; [1] 2
#&gt; 
#&gt; $token_x[[2]]
#&gt; [1] 2 3
#&gt; 
#&gt; $token_x[[3]]
#&gt; [1] 2
#&gt; 
#&gt; $token_x[[4]]
#&gt; [1] 2 4
#&gt; 
#&gt; $token_x[[5]]
#&gt; [1] 2 4 5
#&gt; 
#&gt; $token_x[[6]]
#&gt; [1] 2 4 5 6
#&gt; 
#&gt; 
#&gt; $numeric_features
#&gt; NULL
#&gt; 
#&gt; $categorical_features
#&gt; NULL
#&gt; 
#&gt; $token_y
#&gt; [1] 0 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make sequences of equal length</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> tokens_train<span class="sc">$</span>token_x <span class="sc">%&gt;%</span> <span class="fu">pad_sequences</span>(<span class="at">maxlen =</span> <span class="fu">max_case_length</span>(df<span class="sc">$</span>train_df), <span class="at">value =</span> <span class="dv">0</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> tokens_train<span class="sc">$</span>token_y</span></code></pre></div>
<p>We are now ready to train our custom model (the code below is not
being evaluated).</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fit</span>(<span class="at">object =</span> custom_model, x, y, <span class="at">epochs =</span> <span class="dv">10</span>, <span class="at">batch_size =</span> <span class="dv">10</span>) <span class="co"># see also ?keras::fit.keras.engine.training.Model</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>tokens_test <span class="ot">&lt;-</span> df<span class="sc">$</span>test_df <span class="sc">%&gt;%</span> <span class="fu">tokenize</span>()</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> tokens_test<span class="sc">$</span>token_x <span class="sc">%&gt;%</span> <span class="fu">pad_sequences</span>(<span class="at">maxlen =</span> <span class="fu">max_case_length</span>(df<span class="sc">$</span>train_df), <span class="at">value =</span> <span class="dv">0</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(custom_model, x)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>tokens_test <span class="ot">&lt;-</span> df<span class="sc">$</span>test_df <span class="sc">%&gt;%</span> <span class="fu">tokenize</span>()</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> tokens_test<span class="sc">$</span>token_x</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># normalize by dividing y_test over the standard deviation of y_train</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> tokens_test<span class="sc">$</span>token_y <span class="sc">/</span> <span class="fu">sd</span>(tokens_train<span class="sc">$</span>token_y)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluate</span>(custom_model, x, y)</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
